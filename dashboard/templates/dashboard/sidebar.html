{% load i18n staticfiles dashboard_tags vault_tags %}
{% can_view_team_users_ogs as can_view_tusers_ogs %}

<!-- sidebar -->
<nav id="sidebar">
  <ul class="buttons" id="sidebar-buttons">
    <li>
      <a href="{% url 'dashboard' %}" title="{% trans 'Home' %}" data-toggle="tooltip" data-placement="right">
        <i class="icon fa fa-home"></i>
      </a>
    </li>
    {% if user.is_staff %}
    <li>
      <a href="{% url 'admin:index' %}" title="{% trans 'Settings' %}" data-toggle="tooltip" data-placement="right">
        <i class="icon fa fa-cog"></i>
      </a>
    </li>
    {% endif %}
    <li>
      <a href="{% url 'update_teams_users' %}" title="{% trans 'Manage Team' %}"
         data-toggle="tooltip" data-placement="right">
        <i class="icon fa fa-users"></i>
      </a>
    </li>
    {% if can_view_tusers_ogs %}
    <li>
      <a href="{% url 'team_list_users_ogs' %}" title="Times e UsuÃ¡rios" data-toggle="tooltip" data-placement="right">
        <i class="icon fa fa-building"></i>
      </a>
    </li>
    {% endif %}
  </ul>
</nav>
<!-- /sidebar -->

<script src="{% static 'vendor/js/tools.bundle.js' %}"></script>

<script type="text/html" id="menu_icon_default">
  <a href="<%=url%>" title="<%=name%>" data-toggle="tooltip" data-placement="right">
    <i class="icon <%=icon%>"></i>
  </a>
</script>
<script type="text/javascript">
  {% autoescape off %}
  var urls = [{% info_endpoints %}];
  {% endautoescape %}

  Promise.all(urls.map(u=>fetch(u + "?opt=menu"))).then(responses => {
    return Promise.all(responses.map(res => res.json()));
  }).then(datas => {
      datas.forEach(data => {
      var wid = document.createElement("li");
      wid.innerHTML = tmpl("menu_icon_default", Object.assign({
        "name": "default",
        "icon": "fas fa-question-circle",
        "url": "#"
      }, data));
      var widgets = document.getElementById("sidebar-buttons");
      widgets.appendChild(wid);
    })
});

</script>
